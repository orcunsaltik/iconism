// Variables
$font-<%= family %>: "<%= family %>";
$prefix-<%= family %>: "<%=prefix%>";

// Icon map
$glyphs-<%= family %>: (
<% glyphs.forEach((glyph, index) => { %>  "<%=glyph.name%>": "\<%=glyph.unicode[0].codePointAt(0).toString(16)%>"<%= index < glyphs.length - 1 ? ',' : '' %>
<% }); %>
);

// Font face
@font-face {
  font-family: $font-<%= family %>;
  <%- src %>;
  font-display: swap;
  font-weight: normal;
  font-style: normal;
}

// Mixins
@mixin icon-base {
  font-family: $font-<%= family %> !important;
  font-weight: normal !important;
  font-style: normal;
  font-variant: normal;
  text-decoration: none;
  text-transform: none;
  line-height: 1;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  speak: never;
}

@mixin icon($name) {
  @if map-has-key($glyphs-<%= family %>, $name) {
    &:before {
      content: map-get($glyphs-<%= family %>, $name);
      @include icon-base;
    }
  } @else {
    @warn "Icon '#{$name}' not found in $glyphs-<%= family %>";
  }
}

@mixin icon-size($size) {
  font-size: $size;
}

@mixin icon-rotate($degrees) {
  transform: rotate(#{$degrees}deg);
}

@mixin icon-flip($direction: horizontal) {
  @if $direction == horizontal {
    transform: scaleX(-1);
  } @else if $direction == vertical {
    transform: scaleY(-1);
  }
}

// Base class
<% if (selector) { %>
<%= selector %>:where(:before, :after) {
  @include icon-base;
}
<% } else { %>
:where(<%=tag%>[class^="#{$prefix-<%= family %>}-"], <%=tag%>[class*=" #{$prefix-<%= family %>}-"]):where(:before, :after) {
  @include icon-base;
}
<% } %>

// Icon classes
@each $name, $unicode in $glyphs-<%= family %> {
<% if (selector) { %>
  <%= selector %>.#{$prefix-<%= family %>}-#{$name}:before {
<% } else { %>
  <%=tag%>.#{$prefix-<%= family %>}-#{$name}:before {
<% } %>
    content: "#{$unicode}";
  }
}

// Size utilities
.#{$prefix-<%= family %>}-sm { font-size: 0.75em; }
.#{$prefix-<%= family %>}-lg { font-size: 1.25em; }
.#{$prefix-<%= family %>}-xl { font-size: 1.5em; }
.#{$prefix-<%= family %>}-2x { font-size: 2em; }
.#{$prefix-<%= family %>}-3x { font-size: 3em; }

// Rotate utilities
.#{$prefix-<%= family %>}-rotate-90 { transform: rotate(90deg); }
.#{$prefix-<%= family %>}-rotate-180 { transform: rotate(180deg); }
.#{$prefix-<%= family %>}-rotate-270 { transform: rotate(270deg); }

// Flip utilities
.#{$prefix-<%= family %>}-flip-h { transform: scaleX(-1); }
.#{$prefix-<%= family %>}-flip-v { transform: scaleY(-1); }

// Animation utilities
.#{$prefix-<%= family %>}-spin {
  animation: #{$prefix-<%= family %>}-spin 2s linear infinite;
}

@keyframes #{$prefix-<%= family %>}-spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

// Usage example:
// .my-element {
//   @include icon('arrow-down');
//   @include icon-size(2rem);
//   @include icon-rotate(45);
// }
